<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>V√≤ng Quay May M·∫Øn Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="main.css"
    />

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  </head>
  <body
    class="text-slate-100 min-h-screen flex flex-col items-center py-6 md:py-10 px-4 overflow-hidden"
  >
    <div
      class="w-full max-w-7xl flex flex-col lg:grid lg:grid-cols-3 md:gap-20 items-center justify-center min-h-[90vh] mt-4 md:mt-9"
    >
      <div
        class="w-full max-w-md bg-slate-900/40 backdrop-blur-md p-6 rounded-3xl shadow-2xl border border-white/10 order-2 lg:order-1"
      >
        <h1
          class="text-xl md:text-2xl font-black text-center mb-6 text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500 uppercase tracking-widest"
        >
          Lucky Wheel Master
        </h1>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-end">
          <div class="space-y-2">
            <label
              class="text-xs font-bold uppercase text-slate-400 tracking-wider"
              >S·ªë l∆∞·ª£ng √¥ (1 - 60)</label
            >
            <input
              type="number"
              id="slotInput"
              value="10"
              min="1"
              max="60"
              class="w-full h-[52px] bg-slate-900/60 border border-slate-600 rounded-xl px-4 py-3 focus:ring-2 ring-yellow-500 outline-none transition-all font-mono text-yellow-500 text-lg box-border"
            />
          </div>

          <div class="space-y-2">
            <label
              class="text-xs font-bold uppercase text-slate-400 tracking-wider"
              >C∆° c·∫•u gi·∫£i th∆∞·ªüng</label
            >
            <div class="relative">
              <select
                id="prizeSelect"
                class="w-full h-[52px] bg-slate-900/60 border border-slate-600 rounded-xl px-4 py-3 focus:ring-2 ring-blue-500 outline-none appearance-none cursor-pointer text-sm box-border"
              >
                <option
                  value="khuyenkhich"
                  data-time="5"
                >
                  üéÅ Gi·∫£i Khuy·∫øn Kh√≠ch
                </option>
                <option
                  value="ba"
                  data-time="7"
                >
                  ü•â Gi·∫£i Ba: 200k
                </option>
                <option
                  value="nhi"
                  data-time="10"
                >
                  ü•à Gi·∫£i Nh√¨: 300k
                </option>
                <option
                  value="nhat"
                  data-time="15"
                >
                  ü•á Gi·∫£i Nh·∫•t: 500k
                </option>
              </select>
              <div
                class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-slate-400"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  ></path>
                </svg>
              </div>
            </div>
          </div>
        </div>

        <button
          id="updateWheel"
          class="w-full mt-6 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 py-4 rounded-xl font-bold shadow-lg transition-all active:scale-95 uppercase text-sm tracking-widest"
        >
          L√†m m·ªõi v√≤ng quay
        </button>
      </div>

      <div
        class="relative group order-1 lg:order-2 flex justify-center items-center w-full"
      >
        <div
          class="absolute -top-6 left-1/2 -translate-x-1/2 z-30 filter drop-shadow-[0_5px_15px_rgba(239,68,68,0.4)]"
        >
          <div
            class="w-8 h-10 md:w-10 md:h-14 bg-red-500"
            style="clip-path: polygon(0% 0%, 100% 0%, 50% 100%, 50% 100%)"
          ></div>
          <div
            class="w-8 h-3 md:w-10 md:h-4 bg-red-700 absolute top-0 rounded-t-full"
          ></div>
        </div>

        <div
          id="wheel"
          class="aspect-square w-[80vw] h-[80vw] max-w-[min(85vw,70vh,500px)] max-h-[min(85vw,70vh,500px)] rounded-full border-[8px] md:border-[12px] border-slate-800 shadow-[0_0_80px_rgba(0,0,0,0.6)] relative overflow-hidden transition-transform ease-out flex-shrink-0"
        ></div>

        <button
          id="spinBtn"
          class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-40 w-16 h-16 md:w-24 md:h-24 rounded-full bg-slate-900 border-4 border-yellow-500 shadow-[0_0_30px_rgba(234,179,8,0.4)] flex flex-col items-center justify-center group-hover:scale-105 transition-transform"
        >
          <span
            class="text-yellow-500 font-black text-sm md:text-xl leading-none"
            >QUAY</span
          >
          <span
            class="text-[8px] md:text-[10px] text-white font-bold opacity-60"
            >GO!</span
          >
        </button>
      </div>

      <div class="hidden lg:block lg:order-3"></div>
    </div>

    <div
      id="resultModal"
      class="fixed inset-0 bg-slate-950/90 z-50 flex items-center justify-center hidden opacity-0 transition-opacity duration-500 backdrop-blur-sm"
    >
      <div
        class="bg-slate-800 p-10 rounded-[40px] border-2 border-yellow-500/50 text-center max-w-sm w-full mx-4 transform scale-90 transition-transform duration-500 shadow-[0_0_100px_rgba(234,179,8,0.2)]"
        id="modalContent"
      >
        <div class="text-8xl mb-6 animate-bounce">üèÜ</div>
        <h2 class="text-3xl font-black text-white mb-2 tracking-tight">
          XIN CH√öC M·ª™NG!
        </h2>
        <p
          id="prizeText"
          class="text-xl text-yellow-400 font-bold mb-6 italic"
        ></p>

        <div class="bg-slate-900 rounded-2xl py-6 mb-6 border border-slate-700">
          <p class="text-slate-400 text-sm uppercase tracking-widest mb-2">
            Con s·ªë may m·∫Øn
          </p>
          <div
            id="luckyNumber"
            class="text-7xl font-black text-white drop-shadow-lg"
          >
            --
          </div>
        </div>

        <button
          onclick="closeModal()"
          class="w-full py-4 bg-yellow-500 hover:bg-yellow-400 text-slate-900 rounded-2xl font-black uppercase tracking-widest transition-colors shadow-lg shadow-yellow-500/20"
        >
          Ti·∫øp t·ª•c quay
        </button>
      </div>
    </div>

    <div
      id="toast"
      class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[100] bg-red-500 text-white px-6 py-3 rounded-2xl font-bold shadow-2xl opacity-0 pointer-events-none transition-all duration-300 transform translate-y-5"
    >
      T·∫•t c·∫£ c√°c s·ªë ƒë√£ c√≥ gi·∫£i!
    </div>

    <script>
      // Ch·∫∑n chu·ªôt ph·∫£i
      // document.addEventListener("contextmenu", (event) =>
      //   event.preventDefault()
      // );

      // // Ch·∫∑n c√°c ph√≠m t·∫Øt Inspect (F12, Ctrl+Shift+I, v.v.)
      // document.onkeydown = function (e) {
      //   if (
      //     e.keyCode == 123 ||
      //     (e.ctrlKey &&
      //       e.shiftKey &&
      //       (e.keyCode == "I".charCodeAt(0) ||
      //         e.keyCode == "J".charCodeAt(0) ||
      //         e.keyCode == "C".charCodeAt(0))) ||
      //     (e.ctrlKey && e.keyCode == "U".charCodeAt(0))
      //   ) {
      //     return false;
      //   }
      // };

      // setInterval(() => {
      //   console.clear();
      //   console.log(
      //     "%cD·ª´ng l·∫°i!",
      //     "color: red; font-size: 50px; font-weight: bold;"
      //   );
      //   console.log(
      //     "%cƒê√¢y l√† khu v·ª±c b·∫£o m·∫≠t. M·ªçi h√†nh vi can thi·ªáp ƒë·ªÅu ƒë∆∞·ª£c ghi l·∫°i.",
      //     "font-size: 18px;"
      //   );
      // }, 1000);

      const wheel = document.getElementById("wheel");
      const slotInput = document.getElementById("slotInput");
      const updateBtn = document.getElementById("updateWheel");
      const spinBtn = document.getElementById("spinBtn");
      const prizeSelect = document.getElementById("prizeSelect");
      const resultModal = document.getElementById("resultModal");
      const luckyNumberDisplay = document.getElementById("luckyNumber");
      const prizeTextDisplay = document.getElementById("prizeText");

      const fireworkSound = new Audio(
        "./assets/audios/dragon-studio-fireworks-07-419025.mp3"
      );
      const cheerSound = new Audio(
        "./assets/audios/mixkit-ending-show-audience-clapping-478.wav"
      );

      fireworkSound.loop = true;
      cheerSound.loop = true;

      let currentRotation = 0;
      let isSpinning = false;
      let segments = [];
      let isModalOpen = false;

      const colors = [
        "#ef4444",
        "#3b82f6",
        "#10b981",
        "#f59e0b",
        "#8b5cf6",
        "#ec4899",
        "#06b6d4",
        "#f97316",
      ];

      function triggerContinuousFirework() {
        if (!isModalOpen) return;

        const defaults = {
          startVelocity: 30,
          spread: 360,
          ticks: 60,
          zIndex: 100,
          colors: ["#ff0000", "#ffd700", "#ffffff"],
        };

        // B·∫Øn ph√°o hoa ng·∫´u nhi√™n
        confetti({
          ...defaults,
          particleCount: 40,
          origin: { x: Math.random() * 0.3 + 0.1, y: Math.random() - 0.2 },
        });
        confetti({
          ...defaults,
          particleCount: 40,
          origin: { x: Math.random() * 0.3 + 0.6, y: Math.random() - 0.2 },
        });

        // T·ª± ƒë·ªông g·ªçi l·∫°i ch√≠nh n√≥ sau 500ms ƒë·ªÉ t·∫°o v√≤ng l·∫∑p
        setTimeout(triggerContinuousFirework, 500);
      }

      function showToast(message) {
        const toast = document.getElementById("toast");
        toast.innerText = message;

        // Hi·ªán th√¥ng b√°o
        toast.classList.remove(
          "opacity-0",
          "translate-y-5",
          "pointer-events-none"
        );
        toast.classList.add("opacity-100", "translate-y-0");

        // T·ª± ƒë·ªông ·∫©n sau 3 gi√¢y
        setTimeout(() => {
          toast.classList.add(
            "opacity-0",
            "translate-y-5",
            "pointer-events-none"
          );
          toast.classList.remove("opacity-100", "translate-y-0");
        }, 3000);
      }

      function createWheel() {
        const numSlots = Math.min(
          Math.max(parseInt(slotInput.value) || 10, 1),
          60
        );
        slotInput.value = numSlots;

        wheel.innerHTML = "";
        wheel.style.transition = "none";
        wheel.style.transform = "rotate(0deg)";
        currentRotation = 0;
        segments = [];

        const sliceAngle = 360 / numSlots;
        let gradientParts = [];

        for (let i = 0; i < numSlots; i++) {
          const color = colors[i % colors.length];
          gradientParts.push(
            `${color} ${i * sliceAngle}deg ${(i + 1) * sliceAngle}deg`
          );

          // 1. T·∫°o l·ªõp ph·ªß m√†u x√°m (m·∫∑c ƒë·ªãnh ·∫©n)
          const overlay = document.createElement("div");
          overlay.className =
            "absolute inset-0 transition-opacity duration-500 opacity-0";
          overlay.style.background = `conic-gradient(transparent 0deg, transparent ${
            i * sliceAngle
          }deg, #475569 ${i * sliceAngle}deg, #475569 ${
            (i + 1) * sliceAngle
          }deg, transparent ${(i + 1) * sliceAngle}deg)`;
          wheel.appendChild(overlay);

          // 2. T·∫°o nh√£n s·ªë
          const label = document.createElement("div");
          label.className =
            "absolute top-0 left-1/2 -translate-x-1/2 h-1/2 origin-bottom flex items-start justify-center pt-4 font-black text-white text-shadow z-10";

          if (numSlots > 40) label.style.fontSize = "10px";
          else if (numSlots > 20) label.style.fontSize = "14px";
          else label.style.fontSize = "20px";

          label.style.transform = `translateX(-50%) rotate(${
            i * sliceAngle + sliceAngle / 2
          }deg)`;
          label.innerText = i + 1;
          wheel.appendChild(label);

          segments.push({
            index: i,
            number: i + 1,
            labelElement: label,
            overlayElement: overlay,
            isRemoved: false,
          });
        }
        wheel.style.background = `conic-gradient(${gradientParts.join(", ")})`;
      }

      function spin() {
        const activeSegments = segments.filter((s) => !s.isRemoved);

        if (isSpinning || activeSegments.length === 0) {
          if (activeSegments.length === 0) {
            showToast("T·∫•t c·∫£ c√°c s·ªë ƒë√£ c√≥ gi·∫£i!");
          }
          return;
        }

        const selectedOption = prizeSelect.options[prizeSelect.selectedIndex];
        const spinTime = parseInt(selectedOption.getAttribute("data-time"));
        const prizeLabel = selectedOption.text.split("(")[0];

        isSpinning = true;
        spinBtn.disabled = true;
        spinBtn.style.opacity = "0.5";

        const randomActiveIndex = Math.floor(
          Math.random() * activeSegments.length
        );
        const winningSegment = activeSegments[randomActiveIndex];

        const numSlots = segments.length;
        const sliceAngle = 360 / numSlots;

        const extraDegrees =
          360 - (winningSegment.index * sliceAngle + sliceAngle / 2);
        const totalRotation =
          currentRotation + 360 * 10 + (extraDegrees - (currentRotation % 360));

        wheel.style.transition = `transform ${spinTime}s cubic-bezier(0.1, 0, 0.1, 1)`;
        wheel.style.transform = `rotate(${totalRotation}deg)`;
        currentRotation = totalRotation;

        setTimeout(() => {
          showResult(winningSegment.number, prizeLabel);

          // ƒê√°nh d·∫•u ƒë√£ tr√∫ng
          winningSegment.isRemoved = true;

          // HI·ªÜU ·ª®NG: Hi·ªán l·ªõp ph·ªß m√†u x√°m v√† gi·ªØ ch·ªØ tr·∫Øng
          winningSegment.overlayElement.style.opacity = "1";
          winningSegment.labelElement.style.color = "#ffffff"; // Ch·ªØ tr·∫Øng
          winningSegment.labelElement.style.opacity = "0.8"; // H∆°i m·ªù ch·ªØ m·ªôt ch√∫t ƒë·ªÉ tr√¥ng h√†i h√≤a v·ªõi n·ªÅn x√°m

          isSpinning = false;
          spinBtn.disabled = false;
          spinBtn.style.opacity = "1";
        }, spinTime * 1000);
      }

      function showResult(num, prize) {
        luckyNumberDisplay.innerText = num;
        prizeTextDisplay.innerText = prize;
        resultModal.classList.remove("hidden");

        setTimeout(() => {
          resultModal.classList.add("opacity-100");
          document.getElementById("modalContent").classList.remove("scale-90");

          isModalOpen = true;
          fireworkSound.play();
          cheerSound.play();
          triggerContinuousFirework();
        }, 50);
      }

      function closeModal() {
        resultModal.classList.remove("opacity-100");
        document.getElementById("modalContent").classList.add("scale-90");

        isModalOpen = false;
        fireworkSound.pause();
        fireworkSound.currentTime = 0;
        cheerSound.pause();
        cheerSound.currentTime = 0;

        setTimeout(() => {
          resultModal.classList.add("hidden");
        }, 500);
      }

      updateBtn.addEventListener("click", createWheel);
      spinBtn.addEventListener("click", spin);
      createWheel();
    </script>

    <!-- <script src="./main.js"></script> -->
  </body>
</html>
