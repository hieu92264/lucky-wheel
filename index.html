<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>Lucky Wheel Master 2026 | V√≤ng Quay May M·∫Øn</title>
    <meta
      name="description"
      content="V√≤ng quay may m·∫Øn chuy√™n nghi·ªáp cho s·ª± ki·ªán T·∫øt 2026"
    />

    <link
      rel="icon"
      type="image/png"
      href="https://cdn-icons-png.flaticon.com/512/3893/3893093.png"
    />
    <link
      rel="apple-touch-icon"
      href="https://cdn-icons-png.flaticon.com/512/3893/3893093.png"
    />

    <link
      rel="preconnect"
      href="https://fonts.googleapis.com"
    />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Inter:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link
      rel="stylesheet"
      href="main.css"
    />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ["Inter", "sans-serif"],
              display: ["Montserrat", "sans-serif"],
            },
          },
        },
      };
    </script>

    <style>
      /* T·ªëi ∆∞u tr·∫£i nghi·ªám cu·ªôn v√† ch·∫°m tr√™n mobile */
      html,
      body {
        overflow-x: hidden;
        -webkit-tap-highlight-color: transparent;
        scroll-behavior: smooth;
      }
      h1 {
        font-family: "Montserrat", sans-serif;
      }
    </style>
  </head>

  <body
    class="text-slate-100 min-h-screen flex flex-col items-center py-6 md:py-10 px-4 overflow-hidden"
  >
    <div
      class="w-full max-w-7xl flex flex-col lg:grid lg:grid-cols-3 md:gap-20 items-center justify-center min-h-[90vh] mt-4 md:mt-9"
    >
      <div
        class="w-full max-w-md bg-slate-900/40 backdrop-blur-md p-6 rounded-3xl shadow-2xl border border-white/10 order-2 lg:order-1"
      >
        <h1
          class="text-xl md:text-2xl font-black text-center mb-6 text-transparent bg-clip-text bg-gradient-to-r from-yellow-400 to-orange-500 uppercase tracking-widest"
        >
          Lucky Wheel Master
        </h1>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-end">
          <div class="space-y-2">
            <label
              class="text-xs font-bold uppercase text-slate-400 tracking-wider"
              >S·ªë l∆∞·ª£ng √¥ (1 - 70)</label
            >
            <input
              type="number"
              id="slotInput"
              value="60"
              min="1"
              max="70"
              class="w-full h-[52px] bg-slate-900/60 border border-slate-600 rounded-xl px-4 py-3 focus:ring-2 ring-yellow-500 outline-none transition-all font-mono text-yellow-500 text-lg box-border"
            />
          </div>

          <div class="space-y-2">
            <label
              class="text-xs font-bold uppercase text-slate-400 tracking-wider"
              >C∆° c·∫•u gi·∫£i th∆∞·ªüng</label
            >
            <div class="relative">
              <select
                id="prizeSelect"
                class="w-full h-[52px] bg-slate-900/60 border border-slate-600 rounded-xl px-4 py-3 focus:ring-2 ring-blue-500 outline-none appearance-none cursor-pointer text-sm box-border"
              >
                <option
                  value="khuyenkhich"
                  data-time="5"
                >
                  üéÅ Gi·∫£i Khuy·∫øn Kh√≠ch
                </option>
                <option
                  value="ba"
                  data-time="7"
                >
                  ü•â Gi·∫£i Ba
                </option>
                <option
                  value="nhi"
                  data-time="10"
                >
                  ü•à Gi·∫£i Nh√¨
                </option>
                <option
                  value="nhat"
                  data-time="15"
                >
                  ü•á Gi·∫£i Nh·∫•t
                </option>
              </select>
              <div
                class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-slate-400"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M19 9l-7 7-7-7"
                  ></path>
                </svg>
              </div>
            </div>
          </div>
        </div>

        <button
          id="updateWheel"
          class="w-full mt-6 group relative overflow-hidden bg-gradient-to-r from-yellow-500 via-orange-500 to-yellow-600 p-[2px] rounded-2xl shadow-[0_0_20px_rgba(234,179,8,0.3)] transition-all active:scale-95"
        >
          <div
            class="bg-slate-900/90 group-hover:bg-transparent transition-colors duration-300 rounded-[14px] py-4 px-6 flex items-center justify-center gap-3"
          >
            <svg
              class="w-5 h-5 text-yellow-400 group-hover:text-slate-900 group-hover:rotate-180 transition-all duration-500"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2.5"
                d="M4 4v5h5M20 20v-5h-5M15.24 15.24A8 8 0 1120 12"
              ></path>
            </svg>

            <span
              class="font-black uppercase text-sm tracking-[0.15em] text-yellow-500 group-hover:text-slate-900 transition-colors"
            >
              L√†m m·ªõi v√≤ng quay
            </span>
          </div>
        </button>
      </div>

      <div
        class="relative group order-1 lg:order-2 flex justify-center items-center w-full"
      >
        <div
          class="absolute -top-6 left-1/2 -translate-x-1/2 z-30 filter drop-shadow-[0_5px_15px_rgba(239,68,68,0.4)]"
        >
          <div
            class="w-8 h-10 md:w-10 md:h-14 bg-red-500"
            style="clip-path: polygon(0% 0%, 100% 0%, 50% 100%, 50% 100%)"
          ></div>
          <div
            class="w-8 h-3 md:w-10 md:h-4 bg-red-700 absolute top-0 rounded-t-full"
          ></div>
        </div>

        <div
          id="wheel"
          class="aspect-square w-[80vw] h-[80vw] max-w-[min(85vw,70vh,500px)] max-h-[min(85vw,70vh,500px)] rounded-full border-[8px] md:border-[12px] border-slate-800 shadow-[0_0_80px_rgba(0,0,0,0.6)] relative overflow-hidden transition-transform ease-out flex-shrink-0"
        ></div>

        <button
          id="spinBtn"
          class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-40 w-16 h-16 md:w-24 md:h-24 rounded-full bg-slate-900 border-4 border-yellow-500 shadow-[0_0_30px_rgba(234,179,8,0.4)] flex flex-col items-center justify-center group-hover:scale-105 transition-transform"
        >
          <span
            class="text-yellow-500 font-black text-sm md:text-xl leading-none"
            >QUAY</span
          >
          <span
            class="text-[8px] md:text-[10px] text-white font-bold opacity-60"
            >GO!</span
          >
        </button>
      </div>

      <div class="hidden lg:block lg:order-3"></div>
    </div>

    <div
      id="resultModal"
      class="fixed inset-0 bg-slate-950/90 z-50 flex items-center justify-center hidden opacity-0 transition-opacity duration-500 backdrop-blur-sm"
    >
      <div
        class="bg-slate-800 p-10 rounded-[40px] border-2 border-yellow-500/50 text-center max-w-sm w-full mx-4 transform scale-90 transition-transform duration-500 shadow-[0_0_100px_rgba(234,179,8,0.2)]"
        id="modalContent"
      >
        <div class="text-8xl mb-6 animate-bounce">üèÜ</div>
        <h2 class="text-3xl font-black text-white mb-2 tracking-tight">
          XIN CH√öC M·ª™NG!
        </h2>
        <p
          id="prizeText"
          class="text-xl text-yellow-400 font-bold mb-6 italic"
        ></p>

        <div class="bg-slate-900 rounded-2xl py-6 mb-6 border border-slate-700">
          <p class="text-slate-400 text-sm uppercase tracking-widest mb-2">
            Con s·ªë may m·∫Øn
          </p>
          <div
            id="luckyNumber"
            class="text-7xl font-black text-white drop-shadow-lg"
          >
            --
          </div>
        </div>

        <button
          onclick="closeModal()"
          class="w-full py-4 bg-yellow-500 hover:bg-yellow-400 text-slate-900 rounded-2xl font-black uppercase tracking-widest transition-colors shadow-lg shadow-yellow-500/20"
        >
          Ti·∫øp t·ª•c quay
        </button>
      </div>
    </div>

    <div
      id="toast"
      class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[100] bg-red-500 text-white px-6 py-3 rounded-2xl font-bold shadow-2xl opacity-0 pointer-events-none transition-all duration-300 transform translate-y-5"
    >
      T·∫•t c·∫£ c√°c s·ªë ƒë√£ c√≥ gi·∫£i!
    </div>

    <!-- <script>
      // Ch·∫∑n chu·ªôt ph·∫£i
      document.addEventListener("contextmenu", (event) =>
        event.preventDefault()
      );

      // Ch·∫∑n c√°c ph√≠m t·∫Øt Inspect (F12, Ctrl+Shift+I, v.v.)
      document.onkeydown = function (e) {
        if (
          e.keyCode == 123 ||
          (e.ctrlKey &&
            e.shiftKey &&
            (e.keyCode == "I".charCodeAt(0) ||
              e.keyCode == "J".charCodeAt(0) ||
              e.keyCode == "C".charCodeAt(0))) ||
          (e.ctrlKey && e.keyCode == "U".charCodeAt(0))
        ) {
          return false;
        }
      };

      setInterval(() => {
        console.clear();
        console.log(
          "%cD·ª´ng l·∫°i!",
          "color: red; font-size: 50px; font-weight: bold;"
        );
        console.log(
          "%cƒê√¢y l√† khu v·ª±c b·∫£o m·∫≠t. M·ªçi h√†nh vi can thi·ªáp ƒë·ªÅu ƒë∆∞·ª£c ghi l·∫°i.",
          "font-size: 18px;"
        );
      }, 1000);

      const wheel = document.getElementById("wheel");
      const slotInput = document.getElementById("slotInput");
      const updateBtn = document.getElementById("updateWheel");
      const spinBtn = document.getElementById("spinBtn");
      const prizeSelect = document.getElementById("prizeSelect");
      const resultModal = document.getElementById("resultModal");
      const luckyNumberDisplay = document.getElementById("luckyNumber");
      const prizeTextDisplay = document.getElementById("prizeText");

      const fireworkSound = new Audio(
        "./assets/audios/dragon-studio-fireworks-07-419025.mp3"
      );
      const cheerSound = new Audio(
        "./assets/audios/mixkit-ending-show-audience-clapping-478.wav"
      );

      const riggedPrizes = {
        nhat: [48],
        nhi: [33, 7, 26],
        ba: [10, 45, 55, 21],
        khuyenkhich: [23, 6, 14, 18, 28, 34, 38, 42, 46, 53],
      };

      fireworkSound.loop = true;
      cheerSound.loop = true;

      let currentRotation = 0;
      let isSpinning = false;
      let segments = [];
      let isModalOpen = false;

      const colors = [
        "#ef4444",
        "#3b82f6",
        "#10b981",
        "#f59e0b",
        "#8b5cf6",
        "#ec4899",
        "#06b6d4",
        "#f97316",
      ];

      function triggerContinuousFirework() {
        if (!isModalOpen) return;

        const defaults = {
          startVelocity: 30,
          spread: 360,
          ticks: 60,
          zIndex: 100,
          colors: ["#ff0000", "#ffd700", "#ffffff"],
        };

        confetti({
          ...defaults,
          particleCount: 40,
          origin: { x: Math.random() * 0.3 + 0.1, y: Math.random() - 0.2 },
        });
        confetti({
          ...defaults,
          particleCount: 40,
          origin: { x: Math.random() * 0.3 + 0.6, y: Math.random() - 0.2 },
        });

        setTimeout(triggerContinuousFirework, 500);
      }

      function showToast(message) {
        const toast = document.getElementById("toast");
        toast.innerText = message;

        toast.classList.remove(
          "opacity-0",
          "translate-y-5",
          "pointer-events-none"
        );
        toast.classList.add("opacity-100", "translate-y-0");

        setTimeout(() => {
          toast.classList.add(
            "opacity-0",
            "translate-y-5",
            "pointer-events-none"
          );
          toast.classList.remove("opacity-100", "translate-y-0");
        }, 3000);
      }

      function createWheel() {
        const numSlots = Math.min(
          Math.max(parseInt(slotInput.value) || 10, 1),
          70
        );
        slotInput.value = numSlots;

        wheel.innerHTML = "";
        wheel.style.transition = "none";
        wheel.style.transform = "rotate(0deg)";
        currentRotation = 0;
        segments = [];

        const sliceAngle = 360 / numSlots;
        let gradientParts = [];

        for (let i = 0; i < numSlots; i++) {
          const color = colors[i % colors.length];
          gradientParts.push(
            `${color} ${i * sliceAngle}deg ${(i + 1) * sliceAngle}deg`
          );

          const overlay = document.createElement("div");
          overlay.className =
            "absolute inset-0 transition-opacity duration-500 opacity-0";
          overlay.style.background = `conic-gradient(transparent 0deg, transparent ${
            i * sliceAngle
          }deg, #475569 ${i * sliceAngle}deg, #475569 ${
            (i + 1) * sliceAngle
          }deg, transparent ${(i + 1) * sliceAngle}deg)`;
          wheel.appendChild(overlay);

          const label = document.createElement("div");
          label.className =
            "absolute top-0 left-1/2 -translate-x-1/2 h-1/2 origin-bottom flex items-start justify-center pt-4 font-black text-white text-shadow z-10";

          if (numSlots > 40) label.style.fontSize = "10px";
          else if (numSlots > 20) label.style.fontSize = "14px";
          else label.style.fontSize = "20px";

          label.style.transform = `translateX(-50%) rotate(${
            i * sliceAngle + sliceAngle / 2
          }deg)`;
          label.innerText = i + 1;
          wheel.appendChild(label);

          segments.push({
            index: i,
            number: i + 1,
            labelElement: label,
            overlayElement: overlay,
            isRemoved: false,
          });
        }
        wheel.style.background = `conic-gradient(${gradientParts.join(", ")})`;
      }

      function spin() {
        const activeSegments = segments.filter((s) => !s.isRemoved);

        if (isSpinning || activeSegments.length === 0) {
          if (activeSegments.length === 0) {
            showToast("T·∫•t c·∫£ c√°c s·ªë ƒë√£ c√≥ gi·∫£i!");
          }
          return;
        }

        const selectedOption = prizeSelect.options[prizeSelect.selectedIndex];
        const prizeValue = selectedOption.value;
        const spinTime = parseInt(selectedOption.getAttribute("data-time"));
        const prizeLabel = selectedOption.text.split("(")[0];

        isSpinning = true;
        spinBtn.disabled = true;
        spinBtn.style.opacity = "0.5";

        let winningSegment;

        const MIN_TRIGGER = 50;

        const allReservedNumbers = Object.values(riggedPrizes).flat();

        const isLiveMode = parseInt(slotInput.value) >= MIN_TRIGGER;

        const currentPrizePool = riggedPrizes[prizeValue] || [];
        const availableRigged = activeSegments.filter(
          (s) =>
            currentPrizePool.includes(s.number) &&
            s.number <= parseInt(slotInput.value)
        );

        if (isLiveMode && availableRigged.length > 0) {
          winningSegment =
            availableRigged[Math.floor(Math.random() * availableRigged.length)];
        } else if (isLiveMode) {
          const safeRandomSegments = activeSegments.filter(
            (s) => !allReservedNumbers.includes(s.number)
          );
          winningSegment =
            safeRandomSegments.length > 0
              ? safeRandomSegments[
                  Math.floor(Math.random() * safeRandomSegments.length)
                ]
              : activeSegments[
                  Math.floor(Math.random() * activeSegments.length)
                ];
        } else {
          winningSegment =
            activeSegments[Math.floor(Math.random() * activeSegments.length)];
        }

        const numSlots = segments.length;
        const sliceAngle = 360 / numSlots;

        const extraDegrees =
          360 - (winningSegment.index * sliceAngle + sliceAngle / 2);
        const totalRotation =
          currentRotation + 360 * 10 + (extraDegrees - (currentRotation % 360));

        wheel.style.transition = `transform ${spinTime}s cubic-bezier(0.1, 0, 0.1, 1)`;
        wheel.style.transform = `rotate(${totalRotation}deg)`;
        currentRotation = totalRotation;

        setTimeout(() => {
          showResult(winningSegment.number, prizeLabel);
          winningSegment.isRemoved = true;
          winningSegment.overlayElement.style.opacity = "1";
          winningSegment.labelElement.style.color = "#ffffff";
          winningSegment.labelElement.style.opacity = "0.8";

          isSpinning = false;
          spinBtn.disabled = false;
          spinBtn.style.opacity = "1";
        }, spinTime * 1000);
      }

      function showResult(num, prize) {
        luckyNumberDisplay.innerText = num;
        prizeTextDisplay.innerText = prize;
        resultModal.classList.remove("hidden");

        setTimeout(() => {
          resultModal.classList.add("opacity-100");
          document.getElementById("modalContent").classList.remove("scale-90");

          isModalOpen = true;
          fireworkSound.play();
          cheerSound.play();
          triggerContinuousFirework();
        }, 50);
      }

      function closeModal() {
        resultModal.classList.remove("opacity-100");
        document.getElementById("modalContent").classList.add("scale-90");

        isModalOpen = false;
        fireworkSound.pause();
        fireworkSound.currentTime = 0;
        cheerSound.pause();
        cheerSound.currentTime = 0;

        setTimeout(() => {
          resultModal.classList.add("hidden");
        }, 500);
      }

      updateBtn.addEventListener("click", createWheel);
      spinBtn.addEventListener("click", spin);
      createWheel();
    </script> -->

    <!-- https://console.firebase.google.com/u/2/project/lucky-wheel-469a8/database/lucky-wheel-469a8-default-rtdb/data/~2F -->

    <!-- <script src="./main.js"></script> -->

    <script type="module">
      // --- 1. C·∫§U H√åNH FIREBASE ---
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getDatabase,
        ref,
        onValue,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

      const firebaseConfig = {
        databaseURL:
          "https://lucky-wheel-469a8-default-rtdb.asia-southeast1.firebasedatabase.app/",
      };
      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      let remoteVipSignal = false; // T√≠n hi·ªáu t·ª´ ƒëi·ªán tho·∫°i

      // L·∫Øng nghe t√≠n hi·ªáu b√≠ m·∫≠t
      onValue(ref(db, "isVipMode"), (snapshot) => {
        remoteVipSignal = snapshot.val();
        // B·∫°n c√≥ th·ªÉ x√≥a d√≤ng console.log b√™n d∆∞·ªõi khi ch·∫°y th·∫≠t ƒë·ªÉ gi·∫•u k√≠n
        console.log("System Status:", remoteVipSignal ? "VIP" : "Normal");
      });

      // --- 2. LOGIC V√íNG QUAY ---
      document.addEventListener("contextmenu", (event) =>
        event.preventDefault()
      );

      document.onkeydown = function (e) {
        if (
          e.keyCode == 123 ||
          (e.ctrlKey &&
            e.shiftKey &&
            (e.keyCode == 73 || e.keyCode == 74 || e.keyCode == 67)) ||
          (e.ctrlKey && e.keyCode == 85)
        ) {
          return false;
        }
      };

      const wheel = document.getElementById("wheel");
      const slotInput = document.getElementById("slotInput");
      const updateBtn = document.getElementById("updateWheel");
      const spinBtn = document.getElementById("spinBtn");
      const prizeSelect = document.getElementById("prizeSelect");
      const resultModal = document.getElementById("resultModal");
      const luckyNumberDisplay = document.getElementById("luckyNumber");
      const prizeTextDisplay = document.getElementById("prizeText");

      const fireworkSound = new Audio(
        "./assets/audios/dragon-studio-fireworks-07-419025.mp3"
      );
      const cheerSound = new Audio(
        "./assets/audios/mixkit-ending-show-audience-clapping-478.wav"
      );

      const riggedPrizes = {
        nhat: [48],
        nhi: [33, 7, 26],
        ba: [10, 45, 55, 21],
        khuyenkhich: [23, 6, 14, 18, 28, 34, 38, 42, 46, 53],
      };

      let currentRotation = 0;
      let isSpinning = false;
      let segments = [];
      let isModalOpen = false;

      const colors = [
        "#ef4444",
        "#3b82f6",
        "#10b981",
        "#f59e0b",
        "#8b5cf6",
        "#ec4899",
        "#06b6d4",
        "#f97316",
      ];

      function triggerContinuousFirework() {
        if (!isModalOpen) return;
        confetti({
          particleCount: 40,
          spread: 360,
          origin: { x: Math.random() * 0.3 + 0.1, y: Math.random() - 0.2 },
        });
        confetti({
          particleCount: 40,
          spread: 360,
          origin: { x: Math.random() * 0.3 + 0.6, y: Math.random() - 0.2 },
        });
        setTimeout(triggerContinuousFirework, 500);
      }

      function createWheel() {
        const numSlots = Math.min(
          Math.max(parseInt(slotInput.value) || 10, 1),
          70
        );
        wheel.innerHTML = "";
        wheel.style.transform = "rotate(0deg)";
        currentRotation = 0;
        segments = [];
        const sliceAngle = 360 / numSlots;
        let gradientParts = [];

        for (let i = 0; i < numSlots; i++) {
          const color = colors[i % colors.length];
          gradientParts.push(
            `${color} ${i * sliceAngle}deg ${(i + 1) * sliceAngle}deg`
          );

          const overlay = document.createElement("div");
          overlay.className =
            "absolute inset-0 transition-opacity duration-500 opacity-0";
          overlay.style.background = `conic-gradient(transparent ${
            i * sliceAngle
          }deg, #475569 ${i * sliceAngle}deg, #475569 ${
            (i + 1) * sliceAngle
          }deg, transparent ${(i + 1) * sliceAngle}deg)`;
          wheel.appendChild(overlay);

          const label = document.createElement("div");
          label.className =
            "absolute top-0 left-1/2 -translate-x-1/2 h-1/2 origin-bottom flex items-start justify-center pt-4 font-black text-white z-10";
          label.style.fontSize =
            numSlots > 40 ? "10px" : numSlots > 20 ? "14px" : "20px";
          label.style.transform = `translateX(-50%) rotate(${
            i * sliceAngle + sliceAngle / 2
          }deg)`;
          label.innerText = i + 1;
          wheel.appendChild(label);

          segments.push({
            index: i,
            number: i + 1,
            labelElement: label,
            overlayElement: overlay,
            isRemoved: false,
          });
        }
        wheel.style.background = `conic-gradient(${gradientParts.join(", ")})`;
      }

      function spin() {
        const activeSegments = segments.filter((s) => !s.isRemoved);
        if (isSpinning || activeSegments.length === 0) return;

        const selectedOption = prizeSelect.options[prizeSelect.selectedIndex];
        const prizeValue = selectedOption.value;
        const spinTime = parseInt(selectedOption.getAttribute("data-time"));
        const prizeLabel = selectedOption.text.split("(")[0];

        isSpinning = true;
        spinBtn.disabled = true;

        let winningSegment;
        const isLiveMode = parseInt(slotInput.value) >= 50;
        const allReservedNumbers = Object.values(riggedPrizes).flat();

        // LOGIC K√çCH HO·∫†T T·ª™ XA: Ph·∫£i ƒë·ªß v√© V√Ä ƒëi·ªán tho·∫°i ph·∫£i b·∫≠t ON
        const activateRigging = isLiveMode && remoteVipSignal;

        console.log(
          "Rigging Status:",
          activateRigging ? "Activated" : "Deactivated"
        );

        const currentPrizePool = riggedPrizes[prizeValue] || [];
        const availableRigged = activeSegments.filter(
          (s) =>
            currentPrizePool.includes(s.number) &&
            s.number <= parseInt(slotInput.value)
        );

        if (activateRigging && availableRigged.length > 0) {
          winningSegment =
            availableRigged[Math.floor(Math.random() * availableRigged.length)];
        } else if (isLiveMode) {
          // N·∫øu LiveMode b·∫≠t nh∆∞ng kh√¥ng c√≥ t√≠n hi·ªáu ƒëi·ªán tho·∫°i -> N√© s·ªë VIP ƒë·ªÉ kh√¥ng b·ªã tr√πng gi·∫£i l·ªõn
          const safeRandom = activeSegments.filter(
            (s) => !allReservedNumbers.includes(s.number)
          );
          winningSegment =
            safeRandom.length > 0
              ? safeRandom[Math.floor(Math.random() * safeRandom.length)]
              : activeSegments[
                  Math.floor(Math.random() * activeSegments.length)
                ];
        } else {
          // Ch·∫ø ƒë·ªô test ho·∫∑c kh√¥ng c√≥ t√≠n hi·ªáu -> Ng·∫´u nhi√™n
          winningSegment =
            activeSegments[Math.floor(Math.random() * activeSegments.length)];
        }

        const sliceAngle = 360 / segments.length;
        const extraDegrees =
          360 - (winningSegment.index * sliceAngle + sliceAngle / 2);
        const totalRotation =
          currentRotation + 360 * 10 + (extraDegrees - (currentRotation % 360));

        wheel.style.transition = `transform ${spinTime}s cubic-bezier(0.1, 0, 0.1, 1)`;
        wheel.style.transform = `rotate(${totalRotation}deg)`;
        currentRotation = totalRotation;

        setTimeout(() => {
          showResult(winningSegment.number, prizeLabel);
          winningSegment.isRemoved = true;
          winningSegment.overlayElement.style.opacity = "1";
          isSpinning = false;
          spinBtn.disabled = false;
        }, spinTime * 1000);
      }

      function showResult(num, prize) {
        luckyNumberDisplay.innerText = num;
        prizeTextDisplay.innerText = prize;
        resultModal.classList.remove("hidden");
        setTimeout(() => {
          resultModal.classList.add("opacity-100");
          isModalOpen = true;
          fireworkSound.play();
          cheerSound.play();
          triggerContinuousFirework();
        }, 50);
      }

      window.closeModal = function () {
        // ƒê∆∞a h√†m ra ngo√†i scope module ƒë·ªÉ HTML g·ªçi ƒë∆∞·ª£c
        resultModal.classList.remove("opacity-100");
        isModalOpen = false;
        fireworkSound.pause();
        fireworkSound.currentTime = 0;
        cheerSound.pause();
        cheerSound.currentTime = 0;
        setTimeout(() => resultModal.classList.add("hidden"), 500);
      };

      updateBtn.addEventListener("click", createWheel);
      spinBtn.addEventListener("click", spin);
      createWheel();
    </script>
  </body>
</html>
